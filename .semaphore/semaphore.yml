version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Main
    task:
      jobs:
        - name: SSH and Deploy
          commands:
            - echo "$DEPLOYMENT_KEY" | base64 --decode > deployment.key
            - chmod 400 deployment.key
            - ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no -i deployment.key $SSH_TARGET "cd ~ && bash deployment/stage-blue-green.sh"
      secrets:
        - name: MY_APP_DEPLOYMENT_SSH
